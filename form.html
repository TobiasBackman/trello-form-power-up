<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Form</title>
  <style>
    body { font-family: Arial, sans-serif; }
    .form-container { padding: 10px; }
  </style>
</head>
<body>
  <div class="form-container">
    <h3>Custom Form</h3>
    <label for="question-1">Question 1:</label>
    <input type="text" id="question-1">
    <button id="save-button">Save</button>
  </div>

  <script src="https://p.trellocdn.com/power-up.min.js"></script>
  <script>
    // Log to confirm the form is loaded
    console.log("Form loaded");

    // Trello Power-Up initialization
    var t = window.TrelloPowerUp.iframe();

    // Log to confirm Trello iframe is initialized
    console.log("Trello iframe initialized");

    // Add save button event listener
    document.getElementById('save-button').addEventListener('click', function() {
      var answer = document.getElementById('question-1').value;
      console.log("Saving data:", answer); // Debug log

      t.set('card', 'shared', 'formData', { question1: answer }).then(function() {
        console.log("Data saved"); // Debug log
        t.closePopup();
      }).catch(function(err) {
        console.error("Error saving data:", err); // Error log
      });
    });

    // Render existing data
    t.render(function() {
      console.log("Rendering form data"); // Debug log

      t.get('card', 'shared', 'formData').then(function(data) {
        if (data && data.question1) {
          document.getElementById('question-1').value = data.question1;
          console.log("Loaded saved data:", data.question1); // Debug log
        }
      }).catch(function(err) {
        console.error("Error loading data:", err); // Error log
      });
    });
  </script>
</body>
</html>
